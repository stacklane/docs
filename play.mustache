{{% json /_examples as examples}}
{{% svg /_logos/ as logo }}
{{% partial /_layout }}

{{<layout}}
{{$content}}

<article>
    <header>
        <h1>Playground</h1>

        <p>
            Get started with an example, or create your own.
        </p>
    </header>

    <section>
        <h2>Load from GitHub.com</h2>

        <p>
            A public GitHub.com repository may be loaded and run. Paste your .git URL here.
            We'll check it for Stacklane compatible files and let you know of any problems.
            (Note: Playground data expires 48 hours after created.)
        </p>

        <p>
            <form id="form" method="post" action="/site" >
            <div class="input-group">
                <div class="input-group-addon">{{> logo-github}}</div>
                <input id="github-url" name="gh-url" type="search"
                       class="form-control" placeholder="https://github.com/your/stacklane-repo.git">
                <div class="input-group-addon"><input type="submit" class="btn btn-light btn-sm" value="Load"></div>
            </div>
            </form>
            <div id="form-alert" class="alert alert-danger d-none" role="alert"></div>
        </p>
    </section>

    <section>
        <h2>Examples</h2>

        <!--
            Data is loaded/imported from _examples.json
         -->
        {{#examples by 2 as grp}}
            <div class="card-deck small">
                {{#grp as example}}
                    <div class="card mb-4">
                        <div class="card-body">
                            <h6 class="card-title">{{title}}</h6>
                            <p class="card-text">
                                {{desc}}
                            </p>
                        </div>
                        <div class="card-footer text-right">
                            <a href="{{src}}" class="btn btn-sm btn-light">Source</a>
                            <a href="{{src}}" class="playground-example-loader btn btn-sm btn-light">Load</a>
                        </div>
                    </div>
                {{/grp}}
            </div>
        {{/examples}}

    </section>
</article>

<script>
    function updateAlert(msg){
        $get('form-alert').innerHTML = msg;
    }

    function showAlert() {
        $get('form-alert').classList.remove('d-none');
    }

    function validateForm(){
        var url = $get('github-url').value;
        if (url == null || url.length == 0 || url.indexOf('github.com') < 0) {
            updateAlert('Enter a Github.com URL');
            return false;
        }
        if (!url.startsWith("https://") || !url.endsWith(".git")){
            updateAlert('This does not appear to be a valid Github.com repository URL.');
            return false;
        }
        var c = $get('form').getAttribute('action');
        $get('form').setAttribute('action', c + '?url=' + encodeURIComponent(url));
        return true;
    }

    $on('.playground-example-loader', 'click', function( event ) {
        event.preventDefault();
        $get('github-url').value=event.target.getAttribute('href');
        if (!validateForm()) {
            showAlert();
        } else {
            $get('form').submit();
        }
    });

    $on('github-url', 'keypress', function( event ) {
        $get('form-alert').classList.add('d-none');
    });

    $on('form', 'submit', function( event ) {
        if (!validateForm()) {
            showAlert();
            event.preventDefault();
        }
    });
</script>

{{/content}}
{{/layout}}