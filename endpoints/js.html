<!--TEMPLATE mustache-->
{{% partial /_layout }}

{{< layout}}

{{$title}}JavaScript Endpoints{{/title}}

{{$content}}

<article>
    <header>
        <h1>JavaScript Endpoints</h1>

        <p>
           Learn how to use JavaScript to create custom logic for your views and endpoints.
        </p>
    </header>

    <section>
        <p>
            Stacklane uses a JavaScript <b><a href="/scripting/">subset</a></b> for server-side logic.
            This subset is designed for speed, security, and compile time validation.
        </p>

        <p>
            In many cases JavaScript endpoints are used in conjunction with JavaScript
            <a href="/scripting/suppliers">Suppliers</a>.
            Suppliers allow for code reuse between multiple endpoints, creating simpler endpoint code.
        </p>

        <p>
            Scripts are executed on the server-side only, and their last emitted value
            becomes the response value. Scripts never produce HTML, which is better suited
            for <a href="/endpoints/mustache">Mustache</a> files.
        </p>
    </section>

    <section>
        <h2><a name="routing">Routing</a></h2>

        <p>
            The file name is used to determine both the endpoint path and the HTTP verb it responds to.
            There are several ways of defining JavaScript endpoints, and it's a matter of preference
            which to choose.  There is no functional difference.
            Note that in all cases JavaScript endpoints do not end in a trailing "/".
        </p>

        <h3>Verb Name Only</h3>

        <p>
            Place an uppercase verb name in a directory.
            <code>GET.js</code>, <code>POST.js</code>, <code>PUT.js</code>, <code>DELETE.js</code>.
        </p>

        <p>
            For example <code>/hello/POST.js</code>
            responds to requests for <code>POST /hello</code>.
        </p>
        <p>
            Or for a <a href="/endpoints/dynamic">dynamic path</a> such as <code>/product/{product}/GET.js</code>, a
            corresponding request could be <code>/product/1234</code>.
        </p>

        <h3>Emoji and Name</h3>

        <p>
            Verbs are represented by a specific an emoji prefix.
        </p>

        <ul>
            <li>üñ• - GET</li>
            <li>üìÆ - POST</li>
            <li>‚ùå - DELETE</li>
        </ul>

        <p>
            The rest of the name after verb prefix becomes the endpoint name.
            For example a file name of
            <code>/account/{account}/üñ•settings.js</code>
            responds to requests for <code>GET /account/1234/settings</code>
        </p>
    </section>

    <section>
        <h2><a name="redirect">Redirects</a></h2>

        <h3>Redirects</h3>
        <ul>
            <li>
                Internal redirects -
                Output a string prefixed with "/"
                to perform an absolute redirect to another endpoint within your app.
                For more readable code and additional options, use the
                <a href="/scripting/helpers#redirect">Redirect builder</a> instead.
            </li>
            <li>
                External redirects -
                Output a string prefixed with "http" to perform an external redirect.
            </li>
        </ul>

        <h3>Rerouting</h3>
        <p>
            Similar to an internal redirect, but no extra client request is made.
            A few conditions must exist for this to occur.
        </p>

        <ul>
            <li>It must be a POST/PUT/DELETE request.</li>
            <li>"X-Requested-With" header must exist and equal "XMLHttpRequest" (denoting an AJAX request).</li>
            <li>The script must emit an absolute path for the app, similar to a regular internal redirect.</li>
        </ul>

        <p>
            Given a <code>POST.js</code> code called via AJAX and returning '/show/all', the server would
            internally route and return the result of executing <code>GET /show/all</code>, <b>instead of</b>
            requiring the client to round trip as it would with a normal internal redirect.
        </p>
    </section>
    <section>
        <h2><a name="json">JSON Output</a></h2>

        <p>
            Output an object literal from the script to create a JSON response.  For example:

            <pre><code class="language-javascript">
({
  hello: 'world'
});
            </code></pre>

            Result:

            <pre><code class="language-javascript">
{
  "hello": "world"
}
            </code></pre>

            Stream aware model methods may also be used:

            <pre><code class="language-javascript">
/* Code to assign LoadedList variable */

({
  list: LoadedList.name,
  tasks: LoadedList(()=>Task.all().map(t=>({name:t.title}}))
});
            </code></pre>

            Result:

            <pre><code class="language-javascript">
{
  "list": "hello"
  "tasks": [{"name":"world"}]
}
            </code></pre>
        </p>

    </section>


</article>

{{/content}}
{{/layout}}
