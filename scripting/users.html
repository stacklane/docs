<!--TEMPLATE mustache-->
{{% partial /_layout }}

{{< layout}}

{{$title}}User Scripting{{/title}}

{{$content}}

<article>
    <header>
        <h1>User Scripting</h1>

        <p>
            Learn about scripting with users, roles, and profiles.
        </p>
    </header>

    <section>
        <p>
            User scripting puts into practice the concepts and setup from
            <a href="/settings/users">user settings</a> and <a href="/models/types#profile">user profiles</a>.
            Review these docs before learning about user scripting, or use this doc as an overview
            for how these settings materialize into code.
        </p>

        <div class="alert alert-info small" role="alert">
            The examples below are in JavaScript, but most approaches apply to Mustache templates as well.
        </div>
    </section>

    <section>
        <h2><a name="model">User Model</a></h2>
        <p>
            Users are a represented by a pre-built model that lives in the module 'ðŸ‘¤'.
            All users will have at least a <code>name</code> and <code>email</code> by default,
            which is obtained from whatever social login provider they used (Google, etc).
        </p>
    </section>

    <section>
        <h2><a name="user">Current User</a></h2>

        <p>
            Access the currently authenticated user using the <code>Me</code> variable in the <code>ðŸ‘¤</code>
            module.
        </p>

        <p>
        <pre class="language-javascript"><code>
import {Me} from 'ðŸ‘¤';

({name: Me.name});
    </code></pre>
        </p>
    </section>

    <section>
        <h2><a name="role">Current Role</a></h2>

        <p>
            The <code>Role</code> object in the module 'ðŸ‘¤' is a type-safe set of boolean fields.
            Each field corresponds to a pre-defined role configured in the <a href="/settings/users">user settings file</a>.
        </p>
        <p>
            To query whether a specific role is active:
        </p>
        <p>
        <pre class="language-javascript"><code>
import {Role} from 'ðŸ‘¤';

if (Role.MyCustomRole){
    ...
}
    </code></pre>
        </p>
        <p>
            In most cases authentication state is guaranteed by how the user authentication settings and endpoints are configured.
            But in certain cases of "optional authentication"
            you may need to know whether the <code>Me</code> variable is available (whether a user authenticated).
            In this case you can check the special role of the same name:
        </p>
        <p>
        <pre class="language-javascript"><code>
import {Me, Role} from 'ðŸ‘¤';
import {Msg} from 'ðŸŽ¨';

if (Role.Me){
    ({name: Me.name});
} else {
    // This message must be configured in a style settings file
    ({name: Msg.NotLoggedIn});
}
    </code></pre>
        </p>
    </section>

    <section>
        <h2><a name="profiles">Profiles</a></h2>

        <p>
            <a href="/models/types#profile">User profiles</a>
            are a type of model that allows you to associate custom fields and data directly with a specific user.
            As mentioned in the documentation you can either associate the user profile with only a user,
            <b>or</b> you may associate the user profile with <i>both</i> a user and a tenant container.
        </p>

        <p>
            If you're accessing user profiles for the currently logged in user,
            use the special <code>me()</code> method to load them.
        </p>

        <p>
        <pre class="language-javascript"><code>
import {BasicProfile} from 'ðŸ“¦';

let currentUserProfile = BasicProfile.me();
    </code></pre>
        </p>

        <p>
            Important: the me() method acts like a singleton, and if there hasn't been a user profile setup
            it will auto-create one.
        </p>

        <h3>Adding Groups</h3>
        <p>
            Users are associated with roles via groups.
            For more information on roles and groups see the <a href="/settings/users">user settings</a>.
        </p>
        <p>
            All user profiles have a <code>groups</code> field and embedded <code>Group</code> model.
        </p>
        <p>
            Adding a group in <code>POST.js</code>:
        </p>
        <p>
        <pre class="language-javascript"><code>
import {AccountUser} from 'ðŸ“¦';

AccountUser.me().groups.add(
  new AccountUser.Group().name('Editors')
);
    </code></pre>
        </p>
    </section>
</article>

{{/content}}

{{/layout}}
