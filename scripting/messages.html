<!--TEMPLATE mustache-->
{{% partial /_layout }}

{{< layout}}

{{$title}}Messages{{/title}}

{{$content}}

<article>
    <header>
        <h1>Messages</h1>

        <p>
            Learn about using the Messages object across requests.
        </p>
    </header>

    <section>
        <p>
            Messages are a simple way to communicate a one-time notice, alert, or message.
            They are intended for a single user/visitor to see on the very next page view (GET).
            Messages may be more typically added during <a href="/scripting/helpers#redirect">redirects</a>.
        </p>

        <div class="alert alert-warning small" role="alert">
            Messages are intended for information purposes only, and should not contain sensitive or secure information.
            For example, do not include a user's name, email, etc.
        </div>
    </section>

    <section>
        <h2><a name="add">New Messages</a></h2>

        <p>
            The <code>Messages</code> object is always available and pre-imported.
            There are 4 message levels and typical uses:
        </p>

        <p>
            <ul>
                <li><code>success</code> &dash; Expected action was taken / something occurred.</li>
                <li><code>info</code> &dash; Default / neutral / informational notification.</li>
                <li><code>error</code> &dash; Action not be taken, invalid input, or unexpected error.</li>
                <li><code>warning</code> &dash; Softer error, that may not require further action by the user.</li>
            </ul>
        </p>

        <h3>Global Message</h3>

        <pre><code class="language-javascript">
Messages.success('A new Article was created');
        </code></pre>

        <h3>Field Specific</h3>

        <p>
            Messages may be associated with a specific field name.
            The field name must be interpreted client-side,
            as it may represent a custom named form input field.
        </p>

        <pre><code class="language-javascript">
Messages.fieldError('title', 'Titles may not contain special characters.');
        </code></pre>
    </section>

    <!--
    <section>
        <h2><a name="object">Previous vs Next</a></h2>

        <p>

        </p>
    </section>
   -->
    <section>
        <h2><a name="mustache">Mustache Rendering</a></h2>

        <p>
            For standard handling of form POSTs and message display,
            you'll be emitting the messages via a Mustache template.
        </p>

        <h3>Bootstrap CSS</h3>

        <p>
            The following example maps the message types to Bootstrap classes
            and displays the messages as an "alert" class:
        </p>

        <pre><code class="language-html">
&lt;!--TEMPLATE mustache--&gt;
&#123;&#123;% choose-string-map message error=alert-danger *=alert-* &#125;&#125;

&#123;&#123;#Messages.all&#125;&#125;
&lt;div class="alert &#123;&#123;% choose-string message this.type &#125;&#125;"&gt;
  &#123;&#123;this.value&#125;&#125;
&lt;/div&gt;
&#123;&#123;/Messages.all&#125;&#125;
        </code></pre>

        <h3>Bulma CSS</h3>

        <p>
            The following example maps the message types to Bulma classes
            and displays the messages as a "notification" class:
        </p>

        <pre><code class="language-html">
&lt;!--TEMPLATE mustache--&gt;
&#123;&#123;% choose-string-map message error=is-danger *=is-* &#125;&#125;

&#123;&#123;#Messages.all&#125;&#125;
&lt;div class="notification &#123;&#123;% choose-string message this.type &#125;&#125;"&gt;
  &#123;&#123;this.value&#125;&#125;
&lt;/div&gt;
&#123;&#123;/Messages.all&#125;&#125;
        </code></pre>
    </section>

    <section>
        <h2><a name="server">API Rendering</a></h2>

        <p>
            If form handling is being done as an API call,
            then it's still recommended to use the Messages object and API for
            code readability and convenience.

            In this case you'll want to emit the messages as JSON, immediately on the server-side,
            rather than waiting until the next GET.
        </p>

        <pre><code class="language-javascript">
import {Article} from 'ðŸ“¦';
import {title} from 'form';

new Article().title(title);

Messages.success('Successfully created new Article');

if (title == 'great')
    Messages.fieldInfo('title', 'Great title for the Article!');

({messages: Messages.now()});
        </code></pre>

        <p>
            Calling <code>Messages.now()</code> will emit a JSON array.

            It will also cause all messages to be flushed out so they are not visible on the next GET.

            It is the responsibility of the client making the request to
            interpret this array and display messages accordingly.
        </p>

        <pre><code class="language-javascript">
{
  "messages":[
    {"type": "success", value: "Successfully created new Article"},
    {"type": "info", field: "title", value: "Great title for the Article!"}
  ]
}
        </code></pre>

        <h3>Throwing Messages</h3>

        <p>
            Messages may also be thrown as an error:
        </p>
        <pre><code class="language-javascript">
throw Messages.fieldError('title', 'Not Good');
        </code></pre>

        <p>
            Results in client side JSON with HTTP status code 422:
        </p>

        <pre><code class="language-javascript">
{
  "messages":[
    {"type": "error", "field": "title", "value": "Not Good"}
  ]
}
        </code></pre>
    </section>
</article>

{{/content}}

{{/layout}}
