<!--TEMPLATE mustache-->

{{% partial /_layout }}

{{< layout}}

{{$title}}Build API{{/title}}

{{$content}}

<article>
    <header>
        <h1>Build API</h1>

        <p>
            Learn about using the build API to test sites from client-side IDEs.
        </p>
    </header>

    <section>
        <p>
            Stacklane provides a build API for syncing files, validating + building sites,
            and generating shareable test domains.
            To see this API in action view the source code for the
            <a href="https://github.com/stacklane/ide-jetbrains">WebStorm plugin</a>.
        </p>
    </section>

    <section>
        <h2><a name="auth">Auth</a></h2>

        <p>
            The build API supports a reasonable number of anonymous users per day.
            To indicate anonymous authentication pass <code>Bearer anonymous</code>
            in the <code>Authorization</code> header.
            Only anonymous users are currently supported.
        </p>

        <h3>Endpoint and Project IDs</h3>
        <p>
            All API verbs are performed at the following endpoint:
        </p>
        <p>
            <code>https://api.execute.website/{ProjectId}</code>
        </p>
        <p>
            <code>{ProjectId}</code> should be a GUID-like string
            between 20 and 64 characters (a-z A-Z 0-9 - _).  This could be a
            randomly generated value or SHA-256 hex value.
            For anonymous users the client code should take care to produce
            sufficiently unique values to prevent collisions.
            Generally this would be a unique value produced at IDE startup.
            To perform efficient <code>PATCH</code> operations (syncing),
            this unique GUID-like value should not frequently change.
        </p>
    </section>

    <section>
        <h2><a name="get">GET</a></h2>

        <p>
            Produces a JSON response with the current contents of the <code>ProjectId</code>.
            If the <code>ProjectId</code> does not exist the response status is <b>404</b>.
        </p>

        <h3>JSON Response</h3>
        <p>
        <pre><code class="language-javascript">
{
  "files":[
    { "path": "/ðŸŽ›.yaml", "md5": "m1ChXoeAKCZirpWm3sbPAg==" }
  ]
}
        </code></pre>
        </p>
    </section>

    <section>
        <h2><a name="put">PUT</a></h2>
        <p>
            PUT completely replaces all files for the site.
            It receives the request <code>Content-Type</code> of <code>application/zip</code>.
            The body should contain the binary zip data.
        </p>
        <p>
            PUT always creates a new <code>ProjectId</code> if one does not exist,
            therefore unlike other verbs it will never return 404.
            The response from a successful upload is the current contents as defined by <code>GET</code>.
        </p>
    </section>

    <section>
        <h2><a name="patch">PATCH</a></h2>

        <p>
            Use PATCH for incremental syncing of an existing <code>ProjectId</code>.
            When a <code>ProjectId</code> already exists this is the quickest way to generate a new test instance.
            If the <code>ProjectId</code> does not exist the response status is <b>404</b>.
            This would typically be transparent to the user &mdash;
            for example, if GET returns 404, then automatically perform a PUT instead of trying a PATCH.
            PATCH takes two forms depending on the request Content-Type.
        </p>

        <h3>Add/Replace Files (application/zip)</h3>
        <p>
            Similar to PUT, but the zip should only contain the files to create or update.
            No files will be deleted in this operation.
            Use the <code>md5</code> from GET to determine what files need to be updated.
        </p>

        <h3>Prune/Delete Files (application/json)</h3>
        <p>
            Use this operation if, based on the current contents (GET), it is determined that certain files should
            be deleted.
            This operation informs the server what files to <b>keep / retain</b>.
            Any other files not specified will be deleted.
        </p>
        <p>
        <pre><code class="language-javascript">
{
  "retain":[
    "/the/path/to/keep.js",
    "/other/index.html"
  ]
}
        </code></pre>
        </p>
    </section>

    <section>
        <h2><a name="post">POST</a></h2>

        <p>
            Use the POST operation on a previously uploaded/synced <code>ProjectId</code>.
            This step performs the validation and build of the files, reports any errors,
            and if successful returns a unique domain name for testing and sharing.
        </p>

        <h3>Plain Text Response</h3>
        <p>
            Pass text/plain in the <code>Accept</code> header to receive simple
            build messages, one per line.  In a successful build with no errors,
            the final line will start with https:// and contain the unique test domain for that build.
        </p>

        <h3>Passing Credentials</h3>
        <p>
            The POST operation may optionally pass <a href="/dev#credentials">development credentials</a>.
            When passing the credential JSON file to the build process,
            specify a <code>Content-Type</code> of <code>application/json</code> and
            the JSON credentials file as the content/payload of the request.
        </p>
    </section>

</article>

{{/content}}
{{/layout}}

